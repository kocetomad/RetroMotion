<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first three.js app</title>
		<style>
			body { margin: 0;overflow:hidden; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
        <script src="three.js-master\build\three.js"></script>
        <script src="./Enemy.js"></script>

        <script>

        //--------------------------------------------------------------------------------------------------------
// @author Jordi Ros: shine.3p@gmail.com
//
// GLGif.js
//
//--------------------------------------------------------------------------------------------------------

        var speed=0;
  

        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

        var renderer = new THREE.WebGLRenderer();
         renderer.setSize( window.innerWidth, window.innerHeight );
         document.body.appendChild( renderer.domElement );

		//MATERIAL PRELOADER:
		var track=[];
		var trackMaterial=[];
		for(var i=0;i<8;i++){
        track[i] = new THREE.TextureLoader().load(("animation/sprite_"+i+".png") );
		trackMaterial[i] = new THREE.MeshBasicMaterial( {map : track[i]} );
		}

 
 var geometry = new THREE.Geometry();
        geometry.vertices.push(
            new THREE.Vector3( -1,  1, 0 ),
            new THREE.Vector3( -1, -2, 0 ),
            new THREE.Vector3(  1, -1, 0 ),
            new THREE.Vector3(  -1, 1, 0 )
        );
        geometry.faces.push( new THREE.Face3( 0, 1, 2 ,3) );
    
        geometry.computeBoundingSphere();
        var plane = new THREE.Mesh( geometry, trackMaterial[0] );

        bcgTexture = new THREE.TextureLoader().load(("bcg2.png") );
		bcgMaterial = new THREE.MeshBasicMaterial( {map : bcgTexture} );
        var bcgGeometry = new THREE.PlaneGeometry( 80, 20, 80 );
        var bcg = new THREE.Mesh( bcgGeometry, bcgMaterial );
        bcg.rotation.x=89.5;
        bcg.position.y=30;
        bcg.position.z=9;
        

        DownbcgTexture = new THREE.TextureLoader().load(("animation/sprite_9.png") );
		DownbcgMaterial = new THREE.MeshBasicMaterial( {map : DownbcgTexture} );
        var DownbcgGeometry = new THREE.PlaneGeometry( 80, 80, 40 );
        var Downbcg = new THREE.Mesh( DownbcgGeometry, DownbcgMaterial );
        Downbcg.position.z=plane.position.z-1;
        
        // Downbcg.rotation.z = plane.rotation.z - 100;
        


        var enemies = [];
        enemies.push(new Enemy(plane));
        enemies[enemies.length-1].begin();
        var interval = setInterval(function(){
            enemies.push(new Enemy(plane));
            enemies[enemies.length-1].begin();
        } , 5000);

        // setTimeout(()=>{
            // for(var i=0;i<enemies.length;i++){
            //     enemies[i].begin();
            // }
            // clearInterval(interval);
        // } , 10000);
        // var enemy = function(){
        //     var geometry = new THREE.BoxGeometry( 1, 1, 1 );
        //     var material = new THREE.MeshBasicMaterial( {color: 0x00ff00} );
        //     var cube = new THREE.Mesh( geometry, material );
        //     cube.position.y= 20;
        //     cube.position.z= 0.5;
        //     return cube;
        // }

        
        // for(var i=0;i<enemies.length;i++){
        //     plane.add( enemies[i] );
        // }
        
        

        scene.add( plane ,bcg ,Downbcg);
            camera.position.z = 10;
            camera.position.y = -3;

            var frame=0;
            var turn=false;
            var InTurn=0;
            var turnDir=1;
            var animate = function () {

            ///SETS FRAMERATE 
            setTimeout( function() {
            requestAnimationFrame( animate );
            }, 1000 / 20 );


            
           
			plane.material=trackMaterial[frame];
                // camera.lookAt(new THREE.Vector3(0,90,0));

				//plane.rotation.z += 0.01;
                Downbcg.rotation.z=plane.rotation.z;
                Downbcg.rotation.x=plane.rotation.x;


				renderer.render( scene,camera );
				


                //TURNS
                if(turn==false){
                    var temp=Math.random(0,10);

                    if (temp<=0.04){
                        InTurn=randomIntFromInterval(1,2);
                        turn=true;
                    }
                }
                if(InTurn==1){
                    if(turnDir>0){
                        plane.position.x+=0.1;
                        bcg.position.x-=0.2;
                    }
                    
                    plane.rotation.z -= 0.04*turnDir;
                    if(plane.rotation.z<-0.4){
                        turnDir=-1;
                    } 
                    if(plane.rotation.z>0){
                        plane.rotation.z=0;
                        turnDir=1;
                        InTurn=false;
                        turn=false;
                        
                    }
                    

                }
                if(InTurn==2){
                    if(turnDir>0){
                        plane.position.x-=0.1;
                        bcg.position.x+=0.2;
                    }
                    plane.rotation.z += 0.04*turnDir;
                    if(plane.rotation.z>0.4){
                        turnDir=-1;
                    }
                    if(plane.rotation.z<0){
                        plane.rotation.z=0;
                        turnDir=1;
                        InTurn=false;
                        turn=false;
                        
                    }
                    

                }

                

                //FRAME COUNTER FOR ANIMATION TIMING
				frame++;
				if (frame>=8){
					frame=0;
                }
                

                // cube.position.y-=1
                for(var i=0;i<enemies.length;i++){
                    enemies[i].update();
                }

			};

            animate();
            


            document.addEventListener("keydown", onDocumentKeyDown, false);
function onDocumentKeyDown(event) {
    var keyCode = event.which;
    if (keyCode == 87) {
       speed=0.01;
       plane.position.x+=0.2;
 
     }else{
        speed=0;
    }
    
    if (keyCode == 83) {
       speed=-0.01;
       
       plane.position.x-=0.2;
    }else{
        speed=0;
    }
    
    if (keyCode == 65) {
        plane.position.x+=0.2;
        bcg.position.x+=0.03;


    }
    if (keyCode == 68) {
        plane.position.x-=0.2;
        bcg.position.x-=0.03;

    }
};
function onDocumentKeyUp(event) {
    var keyCode = event.which;
    if (keyCode == 87) {
       speed=0.01;
       plane.position.x+=0.2;

     }else{
        speed=0;
    }
    
    if (keyCode == 83) {
       speed=-0.01;
       
       plane.position.x-=0.2;
    }else{
        speed=0;
    }
    
    if (keyCode == 65) {
        plane.position.x+=0.2;
        bcg.position.x+=0.03;


    }
    if (keyCode == 68) {
        plane.position.x-=0.2;
        bcg.position.x-=0.03;

    }
};
function randomIntFromInterval(min,max) // min and max included
{
    return Math.floor(Math.random()*(max-min+1)+min);
}
		</script>
	</body>
</html>